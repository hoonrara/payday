
---

##  전역 할인 정책 구성

서비스 전역에 공통으로 적용되는 **상황 기반 할인 정책**(예: 연휴 할인, 장애 보상 등)을 구성하였습니다.
특정 결제 수단이나 쿠폰에 관계없이, 전역 할인 정책은 최종 결제 금액에 일괄 적용됩니다.

---

###  구조 개요

| 항목        | 설명                                                |
| --------- | ------------------------------------------------- |
| **패턴**    | 전략 패턴 (`DiscountPolicy`)                          |
| **적용 방식** | `@Profile` 기반 스프링 프로파일 설정                         |
| **적용 위치** | 결제 서비스(PaymentService) 내부 `finalPaidAmount` 결정 시점 |
| **정책 종류** | 기본(Default), 연휴(Holiday), 장애(ErrorEvent) 등        |

---

###  적용 예시

```yaml
spring:
  profiles:
    active: holiday
```

* `application.yml`의 `active` 프로파일에 따라 자동으로 할인 정책 빈이 주입됩니다.
* 프로파일이 없거나 `default`인 경우 할인 없이 결제가 진행됩니다.

---

###  전략 패턴 구성

**1. 전략 인터페이스**

```java
public interface DiscountPolicy {
    int calculateDiscount(int originalAmount);
}
```

**2. 정책 구현체**

```java
@Profile("default")
@Component
public class DefaultDiscountPolicy implements DiscountPolicy {
    public int calculateDiscount(int originalAmount) {
        return originalAmount;
    }
}

@Profile("holiday")
@Component
public class HolidayDiscountPolicy implements DiscountPolicy {
    public int calculateDiscount(int originalAmount) {
        return (int)(originalAmount * 0.8); // 20% 할인
    }
}

@Profile("error-event")
@Component
public class ErrorEventDiscountPolicy implements DiscountPolicy {
    public int calculateDiscount(int originalAmount) {
        return (int)(originalAmount * 0.9); // 10% 할인
    }
}
```

---

###  적용 위치 – 결제 로직 내

```java
int finalPaidAmount = discountPolicy.calculateDiscount(discountedAmount);
```

* 쿠폰 적용 후의 금액(`discountedAmount`)에 대해 **전역 할인 정책**을 한 번 더 적용하여 `finalPaidAmount`를 결정합니다.
* 실 결제 금액은 이 `finalPaidAmount`가 사용됩니다.

---

###  전체 할인 흐름

1. 사용자가 충전 요청 (예: 10,000원)
2. 쿠폰이 있다면 → 쿠폰 할인 적용 (예: 8,000원)
3. 전역 정책 존재 시 → `@Profile` 할인 적용 (예: holiday → 8,000 → 6,400원)
4. 이 금액을 바탕으로 토스페이먼츠 혹은 페이크 게이트웨이 결제 진행
5. 실제 충전 포인트는 최초 요청 금액인 10,000원

---


* 테스트 환경/운영 환경에 따라 **유연하게 할인 정책을 주입** 가능
(`application.yml`의 프로파일만 바꾸면 바로 테스트 가능 )

* 단순한 구조지만 **서비스 전체에 정책을 일괄 적용할 수 있음** 

---

