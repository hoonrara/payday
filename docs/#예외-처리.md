
---

## â— ì˜ˆì™¸ ì²˜ë¦¬ êµ¬ì¡°

ë³¸ í”„ë¡œì íŠ¸ëŠ” ëª¨ë“  ë„ë©”ì¸ì—ì„œ ì˜ˆì™¸ë¥¼ ì¼ê´€ë˜ê²Œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´
**ì „ì—­ ErrorCode + ì»¤ìŠ¤í…€ Exception + ê³µí†µ ErrorResponse êµ¬ì¡°**ë¥¼ ì±„íƒí–ˆìŠµë‹ˆë‹¤.

ì˜ˆì™¸ ë°œìƒ ì‹œ ë‹¤ìŒê³¼ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µë©ë‹ˆë‹¤:

```json
{
  "message": "ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ìš©ìì…ë‹ˆë‹¤.",
  "code": "USER_NOT_FOUND",
  "status": 404
}
```

---

### ğŸ“Œ ì²˜ë¦¬ íë¦„ ìš”ì•½

1. ê° ë„ë©”ì¸ì—ì„œ `BusinessException` ìƒì†ë°›ì•„ ì˜ˆì™¸ ë˜ì§
2. `ErrorCode` enumìœ¼ë¡œ ë„ë©”ì¸ë³„ ë©”ì‹œì§€/ìƒíƒœ ì½”ë“œ ì •ì˜
3. `GlobalExceptionHandler`ì—ì„œ ëª¨ë“  ì˜ˆì™¸ ì²˜ë¦¬ í†µí•©
4. `ErrorResponse` í˜•ì‹ìœ¼ë¡œ í”„ë¡ íŠ¸ì— ì‘ë‹µ (Swaggerì—ë„ ë™ì¼ í˜•ì‹ ë°˜ì˜)

---

### ğŸ§± í•µì‹¬ í´ë˜ìŠ¤

#### âœ… `ErrorCode.java`

```java
@Getter
public enum ErrorCode {
    USER_NOT_FOUND("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ìš©ìì…ë‹ˆë‹¤.", HttpStatus.NOT_FOUND),
    INVALID_PAYMENT("ê²°ì œ ìŠ¹ì¸ ì‹¤íŒ¨", HttpStatus.BAD_REQUEST),
    COUPON_OUT_OF_STOCK("ì¿ í°ì´ ëª¨ë‘ ì†Œì§„ë˜ì—ˆìŠµë‹ˆë‹¤.", HttpStatus.BAD_REQUEST),
    DUPLICATE_EMAIL("ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤.", HttpStatus.BAD_REQUEST),
    UNKNOWN_ERROR("ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", HttpStatus.INTERNAL_SERVER_ERROR),
    // ìƒëµ...
    ;

    private final String message;
    private final HttpStatus status;

    ErrorCode(String message, HttpStatus status) {
        this.message = message;
        this.status = status;
    }
}
```

---

#### âœ… `BusinessException.java`

```java
@Getter
public abstract class BusinessException extends RuntimeException {
    private final ErrorCode errorCode;

    public BusinessException(ErrorCode errorCode) {
        super(errorCode.getMessage());
        this.errorCode = errorCode;
    }
}
```

---

#### âœ… `ErrorResponse.java`

```java
@Getter
@AllArgsConstructor
@Schema(description = "ì—ëŸ¬ ì‘ë‹µ ê°ì²´ ì˜ˆì‹œ")
public class ErrorResponse {

  @Schema(description = "ì—ëŸ¬ ë©”ì‹œì§€", example = "ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ìš©ìì…ë‹ˆë‹¤.")
  private final String message;

  @Schema(description = "ì—ëŸ¬ ì½”ë“œ", example = "USER_NOT_FOUND")
  private final String code;

  @Schema(description = "HTTP ìƒíƒœ ì½”ë“œ", example = "404")
  private final int status;
}
```

---

#### âœ… `GlobalExceptionHandler.java`

```java
@RestControllerAdvice
@Slf4j
public class GlobalExceptionHandler {

    @ExceptionHandler(BusinessException.class)
    public ResponseEntity<ErrorResponse> handleBusinessException(BusinessException ex) {
        log.warn("Business ì˜ˆì™¸ ë°œìƒ: {}", ex.getMessage());
        return ResponseEntity
                .status(ex.getErrorCode().getStatus())
                .body(new ErrorResponse(
                        ex.getErrorCode().getMessage(),
                        ex.getErrorCode().name(),
                        ex.getErrorCode().getStatus().value()
                ));
    }

    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<ErrorResponse> handleValidationException(MethodArgumentNotValidException ex) {
        String errorMessage = ex.getBindingResult()
                .getFieldErrors()
                .stream()
                .map(error -> error.getField() + ": " + error.getDefaultMessage())
                .findFirst()
                .orElse("ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨");

        return ResponseEntity
                .status(HttpStatus.BAD_REQUEST)
                .body(new ErrorResponse(
                        errorMessage,
                        ErrorCode.INVALID_REQUEST.name(),
                        HttpStatus.BAD_REQUEST.value()
                ));
    }

    @ExceptionHandler(RuntimeException.class)
    public ResponseEntity<ErrorResponse> handleRuntimeException(RuntimeException ex) {
        log.error("ì„œë²„ ì˜¤ë¥˜ ë°œìƒ", ex);
        return ResponseEntity
                .status(ErrorCode.UNKNOWN_ERROR.getStatus())
                .body(new ErrorResponse(
                        ErrorCode.UNKNOWN_ERROR.getMessage(),
                        ErrorCode.UNKNOWN_ERROR.name(),
                        ErrorCode.UNKNOWN_ERROR.getStatus().value()
                ));
    }
}
```

---

#### âœ… ì˜ˆì‹œ ì»¤ìŠ¤í…€ ì˜ˆì™¸ í´ë˜ìŠ¤

```java
public class DuplicateEmailException extends BusinessException {
    public DuplicateEmailException() {
        super(ErrorCode.DUPLICATE_EMAIL);
    }
}

public class MissingUserIdForMeEndpointException extends BusinessException {
    public MissingUserIdForMeEndpointException() {
        super(ErrorCode.MISSING_USER_ID_FOR_ME_ENDPOINT);
    }
}
```

---
